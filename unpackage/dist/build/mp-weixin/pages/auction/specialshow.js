(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/auction/specialshow"],{"0393":function(t,o,e){"use strict";e.r(o);var n=e("3866"),i=e.n(n);for(var a in n)"default"!==a&&function(t){e.d(o,t,(function(){return n[t]}))}(a);o["default"]=i.a},"0f64":function(t,o,e){"use strict";var n;e.d(o,"b",(function(){return i})),e.d(o,"c",(function(){return a})),e.d(o,"a",(function(){return n}));var i=function(){var t=this,o=t.$createElement;t._self._c},a=[]},3866:function(t,o,e){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n={props:{list:Array,loading:{type:Boolean,default:!1}},data:function(){return{}},watch:{list:function(t){this.$forceUpdate()}},methods:{}};o.default=n},"5d66":function(t,o,e){"use strict";e.r(o);var n=e("efc9c"),i=e("6aa2");for(var a in i)"default"!==a&&function(t){e.d(o,t,(function(){return i[t]}))}(a);e("abb3");var u,c=e("f0c5"),s=Object(c["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],u);o["default"]=s.exports},"64d3":function(t,o,e){"use strict";var n=e("ddcb"),i=e.n(n);i.a},"6aa2":function(t,o,e){"use strict";e.r(o);var n=e("f551"),i=e.n(n);for(var a in n)"default"!==a&&function(t){e.d(o,t,(function(){return n[t]}))}(a);o["default"]=i.a},8802:function(t,o,e){"use strict";e.r(o);var n=e("d6df"),i=e("0393");for(var a in i)"default"!==a&&function(t){e.d(o,t,(function(){return i[t]}))}(a);e("afd5");var u,c=e("f0c5"),s=Object(c["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],u);o["default"]=s.exports},a214:function(t,o,e){"use strict";(function(t){e("27ea");n(e("66fd"));var o=n(e("5d66"));function n(t){return t&&t.__esModule?t:{default:t}}t(o.default)}).call(this,e("543d")["createPage"])},abb3:function(t,o,e){"use strict";var n=e("c5e4"),i=e.n(n);i.a},afd5:function(t,o,e){"use strict";var n=e("be82"),i=e.n(n);i.a},be82:function(t,o,e){},c35f:function(t,o,e){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n={props:{pageCount:Number,pageNumber:Number},data:function(){return{}},methods:{}};o.default=n},c5e4:function(t,o,e){},d6df:function(t,o,e){"use strict";var n;e.d(o,"b",(function(){return i})),e.d(o,"c",(function(){return a})),e.d(o,"a",(function(){return n}));var i=function(){var t=this,o=t.$createElement;t._self._c},a=[]},ddcb:function(t,o,e){},e642:function(t,o,e){"use strict";e.r(o);var n=e("c35f"),i=e.n(n);for(var a in n)"default"!==a&&function(t){e.d(o,t,(function(){return n[t]}))}(a);o["default"]=i.a},ed14:function(t,o,e){"use strict";e.r(o);var n=e("0f64"),i=e("e642");for(var a in i)"default"!==a&&function(t){e.d(o,t,(function(){return i[t]}))}(a);e("64d3");var u,c=e("f0c5"),s=Object(c["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],u);o["default"]=s.exports},efc9c:function(t,o,e){"use strict";e.d(o,"b",(function(){return i})),e.d(o,"c",(function(){return a})),e.d(o,"a",(function(){return n}));var n={pagePagination:function(){return e.e("uni_modules/page-pagination/components/page-pagination/page-pagination").then(e.bind(null,"f9ce"))}},i=function(){var t=this,o=t.$createElement;t._self._c;t._isMounted||(t.e0=function(o){t.showVipDialog=!0},t.e1=function(o){t.showVipDialog=!1},t.e2=function(o){t.showBuyDialog=!1})},a=[]},f551:function(t,o,e){"use strict";(function(t){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n=a(e("8802")),i=a(e("ed14"));function a(t){return t&&t.__esModule?t:{default:t}}function u(t){return l(t)||r(t)||s(t)||c()}function c(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(t,o){if(t){if("string"===typeof t)return f(t,o);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?f(t,o):void 0}}function r(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function l(t){if(Array.isArray(t))return f(t)}function f(t,o){(null==o||o>t.length)&&(o=t.length);for(var e=0,n=new Array(o);e<o;e++)n[e]=t[e];return n}var h=function(){e.e("components/easy-loadimage/easy-loadimage").then(function(){return resolve(e("9b40"))}.bind(null,e)).catch(e.oe)},d={components:{listempty:n.default,nomore:i.default,easyLoadimage:h},data:function(){return{lotUserDepositTips:t.getStorageSync("lotUserDepositTips")||!1,showBuyDialog:!1,isCheck:!0,vipCoupon:!1,showLeft:!1,showRight:!1,catIndex:0,modalName:null,vipCouponAmount:"",showVipDialog:"",countDownStr:"",userBalance:"",auction:{},currentLot:{},lotList:[],dataList:[],cats:[{goodsType:"",goodsTypeName:"全部"}],allLots:[],currentPage:1,totalPage:1,pageSize:30,totalCount:0,scrollViewTop:0,loading:!0,queryObj:{auctionId:"198",followed:!1},startData:{},timerId:"",waterfall:!0,stockTimerId:"",scrollTop:0}},watch:{isCheck:function(t){console.log(t)}},onLoad:function(t){t.auctionId&&(this.queryObj.auctionId=t.auctionId),this.getAuction(),this.getAuctionCouponsCount()},onPullDownRefresh:function(){this.getAuction(),this.getAuctionCouponsCount(),this.lotList=[],setTimeout(t.stopPullDownRefresh,500)},onShow:function(){this.getAuction(),this.getAuctionCouponsCount()},beforeDestroy:function(){clearInterval(this.timerId),clearInterval(this.stockTimerId)},beforeRouteLeave:function(){clearInterval(this.timerId),clearInterval(this.stockTimerId)},destroyed:function(){console.log("destroyed")},methods:{start:function(t){this.startData.clientX=t.changedTouches[0].clientX,this.startData.clientY=t.changedTouches[0].clientY},end:function(o){if(!this.showLeft&&!this.showRight){var e=o.changedTouches[0].clientX-this.startData.clientX,n=o.changedTouches[0].clientY-this.startData.clientY;n<-50||n>50||(e>50?this.currentPage>1?(this.showRight=!0,this.changePage(this.currentPage-1)):t.$toast.showError("当前已经是第一页！"):e<-50&&(this.currentPage<this.totalPage?(this.showLeft=!0,this.changePage(this.currentPage+1)):t.$toast.showError("当前已经是最后一页！")))}},changePage:function(t,o){var e=this,n=t;this.$refs["paging"].clickPage(n);var i=this.queryObj.followed?this.allLots.filter((function(t){return t.followed})):this.allLots,a=this.totalPage;if(!this.loading){this.lotList=[],this.loading=!0;var u=this;if(n<=a){this.currentPage=n;var c=(n-1)*this.pageSize,s=c+this.pageSize;this.lotList=i.slice(c,s),this.scrollViewTop=this.scrollTop,this.$nextTick((function(){return e.scrollViewTop=0}))}this.loading=!1,setTimeout((function(){u.showLeft=!1,u.showRight=!1}),600)}},onScroll:function(t){var o=t.detail;this.scrollTop=o.scrollTop},getAuctionLotStock:function(){var o=this;if(this.auction&&this.auction.auctionEndTime){var e=new Date(this.auction.auctionEndTime.replace(/\-/g,"/")).getTime();this.nowTime>=e&&clearInterval(this.stockTimerId)}t.$api.getAuctionLotStock(this.queryObj).then((function(t){var e=t.data||{},n=function(t){var n=o.lotList.find((function(o){return o.auctionLotAutoId===t}));n&&(n.stock=e[t])};for(var i in e)n(i)}))},lotStock:function(){var t=this;this.stockTimerId||(this.stockTimerId=setInterval(t.getAuctionLotStock,2e3))},loadMore:function(){var t=this.queryObj.followed?this.allLots.filter((function(t){return t.followed})):this.allLots,o=this.currentPage,e=this.totalPage;if(!this.loading){if(this.loading=!0,o<e){var n,i=o*this.pageSize,a=i+this.pageSize;this.currentPage++,(n=this.lotList).push.apply(n,u(t.slice(i,a)))}this.loading=!1}},back:function(){t.navigateBack()},changeListType:function(){this.waterfall=!this.waterfall,this.$forceUpdate()},changeFollow:function(){if(this.queryObj.followed=!this.queryObj.followed,this.currentPage=1,this.queryObj.followed){var t=this.allLots.filter((function(t){return t.followed}));this.totalPage=Math.ceil(t.length/this.pageSize),this.lotList=t.slice(0,this.pageSize),this.totalCount=t.length}else this.totalPage=Math.ceil(this.allLots.length/this.pageSize),this.lotList=this.allLots.slice(0,this.pageSize),this.totalCount=this.allLots.length;this.$refs["paging"],this.$refs["paging"].clickPage(1)},getAuction:function(){var o=this;this.getLots(),t.$api.getAuction(this.queryObj).then((function(t){o.userBalance=t.userBalance,o.auction=t.data,o.vipCoupon=t.vipCoupon,o.nowTime=parseInt(t.nowTime),o.countDown()}))},countDown:function(){if(this.auction.auctionBeginTime){var o=new Date(this.auction.auctionBeginTime.replace(/\-/g,"/")).getTime(),e=o-6e4,n=new Date(this.auction.auctionEndTime.replace(/\-/g,"/")).getTime(),i=this;this.timerId&&(clearInterval(this.timerId),this.timerId=0),this.timerId=setInterval((function(){i.nowTime+=1e3,i.nowTime>o&&i.nowTime<=n?(i.countDownStr="距结束"+t.$utils.date.countDown(i.nowTime,n),i.auction.auctionStatus=1,i.$forceUpdate()):i.nowTime<=o?(i.countDownStr="距开始"+t.$utils.date.countDown(i.nowTime,o),i.nowTime>=e&&i.vipCoupon&&(i.auction.auctionStatus=1,i.$forceUpdate())):(i.countDownStr="",i.auction.auctionStatus=2,i.$forceUpdate(),clearInterval(i.timerId))}),1e3)}},consumeAuctionCoupon:function(){var o=this;t.$api.consumeAuctionCoupon(this.queryObj).then((function(e){t.$toast.showSuccess("操作成功"),o.showVipDialog=!1,o.getAuction(),o.getAuctionCouponsCount()}))},getAuctionCouponsCount:function(){var o=this;t.$api.getAuctionCouponsCount().then((function(t){o.vipCouponAmount=t.data}))},catChangeEvent:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.queryObj.goodsType=t.goodsType,this.catIndex=o,this.getLots()},getLotsGoodsCategory:function(){var o=this;t.$api.getLotsGoodsCategory(this.queryObj).then((function(t){o.cats=t.rows||[],o.cats.unshift({goodsType:"",goodsTypeName:"全部"})}))},getLots:function(){var o=this;t.$api.getLots(this.queryObj).then((function(e){(new Date).getTime();var n=e.rows,i=e.rows;o.queryObj.followed&&(i=i.filter((function(t){return t.followed})));var a=i.slice(0,o.pageSize);if(o.currentPage>1){var u=(o.currentPage-1)*o.pageSize,c=u+o.pageSize;a=i.slice(u,c)}else o.currentPage=1;o.lotList=a.map((function(e){var n=e.auctionLotSellerStock||0;return e.stock=e.auctionLotStock-n,e.lock=t.$session.checkLotId(o.queryObj.auctionId,e.auctionLotAutoId),e})),o.totalPage=Math.ceil(i.length/o.pageSize),o.totalCount=i.length,o.loading=!1,o.$nextTick((function(){}));var s=o;setTimeout((function(){s.allLots=n.map((function(o){var e=o.auctionLotSellerStock||0;return o.stock=o.auctionLotStock-e,o.lock=t.$session.checkLotId(s.queryObj.auctionId,o.auctionLotAutoId),o}))}),1e3),o.getAuctionLotStock(),o.lotStock()}))},followLot:function(o,e){var n=this.lotList[e];t.$api.followLot({auctionLotAutoId:o}).then((function(o){t.$toast.showSuccess("操作成功"),n.followed=!n.followed,n.followed?n.auctionLotFollow++:n.auctionLotFollow--}))},goToDetail:function(o){t.navigateTo({url:"/pages/auction/goodsdetail?auctionId="+this.queryObj.auctionId+"&lotId="+o.lotId+"&goodsId="+o.lotGoodsId})},openBuyDialog:function(o){this.currentLot=o,t.getStorageSync("lotUserDepositTips")?this.secKillLot():this.showBuyDialog=!0},secKillLot:function(){var o=this;if(!this.btnloading){this.btnloading=!0;var e=this;setTimeout((function(){return e.btnloading=!1}),500),t.$api.secKillLot({auctionId:this.queryObj.auctionId,lotId:this.currentLot.lotId}).then((function(e){t.$session.lockLotId(o.queryObj.auctionId,o.currentLot.auctionLotAutoId),o.currentLot.lock=!0,t.$toast.showSuccess("抢购成功")})).catch((function(o){t.$toast.showError(o.message)}))}},hideModal:function(t){this.showBuyDialog=!1},saveCheck:function(){this.isCheck?(t.setStorageSync("lotUserDepositTips",!0),this.secKillLot(),this.showBuyDialog=!1):t.$toast.showToast("请勾选下次不要弹出！")},changeCheck:function(){this.isCheck=!this.isCheck}}};o.default=d}).call(this,e("543d")["default"])}},[["a214","common/runtime","common/vendor"]]]);