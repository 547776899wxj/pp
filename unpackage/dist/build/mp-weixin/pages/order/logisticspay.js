(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/logisticspay"],{"1a2f":function(e,t,n){"use strict";n.r(t);var r=n("54b7"),s=n.n(r);for(var a in r)"default"!==a&&function(e){n.d(t,e,(function(){return r[e]}))}(a);t["default"]=s.a},"54b7":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={props:{show:{type:Boolean,default:!1},addressList:{type:Array,default:[]}},data:function(){return{alert:!1}},watch:{show:function(e){this.alert=e}},methods:{toAddress:function(){e.navigateTo({url:"/pages/user/address"})},hideModal:function(e){this.alert=!1,this.$emit("cancel")},goToAdd:function(t){var n="/pages/user/address/add";t&&(n+="?addressId="+t),e.navigateTo({url:n})},chooseAddress:function(e){for(var t=0;t++;t<this.addressList.length)this.addressList[e].checked=t==e;this.$emit("choose",this.addressList[e])}}};t.default=n}).call(this,n("543d")["default"])},"5d8c":function(e,t,n){"use strict";var r=n("6dac"),s=n.n(r);s.a},"6dac":function(e,t,n){},"7a98":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=s(n("8b87"));function s(e){return e&&e.__esModule?e:{default:e}}var a={data:function(){return{lotOrderId:"",details:[],addressList:[],order:{},addressId:"",orderAddress:{},showAddress:!1,form:{payCheck:!0,lotOrderId:"",payId:"",channelType:"",money:0},channelData:[]}},components:{changeAddress:r.default},onLoad:function(e){var t=e.orderId||"821050468916001";this.lotOrderId=t,this.form.lotOrderId=t,this.initPayChannel()},onShow:function(){this.getAllAddress(),this.getExpressOrderData()},methods:{onChannelSelect:function(e){for(var t=0;t<this.channelData.length;t++)this.channelData[t].channelCheck=0,this.channelData[t].channelType==e&&(this.channelData[t].channelCheck=1)},initPayChannel:function(){var t=this;e.$api.getPayChannel({}).then((function(e){t.channelData=e.data}))},checkClick:function(){this.form.payCheck=!this.form.payCheck},showAddressList:function(){for(var e in this.addressList)this.addressId==this.addressList[e].addressId?this.addressList[e]["checked"]=!0:this.addressList[e]["checked"]=!1;this.showAddress=!0},getAllAddress:function(){var t=this;e.$api.getAllAddress().then((function(e){e.success&&(t.addressList=e.rows||[])}))},chooseAddress:function(e){this.addressId=e.addressId,this.form.addressId=e.addressId,this.showAddress=!1,console.log("chooseAddress2:"+this.addressId),this.getExpressOrderData()},toAddress:function(){e.navigateTo({url:"/pages/user/address?needBackAddressId="+!0})},toAgreement:function(){e.navigateTo({url:"/pages/login/agreement/agreement?agreementId=3"})},getExpressOrderData:function(){var t=this;console.log("addressId:"+this.addressId);var n={lotOrderId:this.lotOrderId,payId:210,addressId:this.addressId,ruleId:"app_pp_pay_for_express"};e.$api.getOrderData(n).then((function(e){if(e.success){var n=e.data,r=n.details,s=n.discountMoneys,a=n.order,d=n.address,o=n.addressId;t.details=r,t.discountMoneys=s,t.order=a,t.orderAddress=d,t.addressId=o,t.form.addressId=o,t.form.money=a.orderPayMoney||0}}))},getExpressAreaName:function(e){return e.indexOf("-")>=0?e.substring(0,e.indexOf("-")):e},getMoneyForYuan:function(e){if(!e)return"0.";var t=e+"";return t.indexOf(".")>=0?t.substring(0,t.lastIndexOf(".")+1):t+"."},getMoneyForFen:function(e){if(!e)return"00";var t=e+"";return t.indexOf(".")>=0?t.substring(t.lastIndexOf(".")+1,t.length):"00"},orderPay:function(){var t=this;if(this.form.addressId){for(var n=0;n<this.channelData.length;n++)1==this.channelData[n].channelCheck&&(this.form.payId=this.channelData[n].payId,this.form.channelType=this.channelData[n].channelType);if(""!=this.form.lotOrderId)if(this.form.money<=0)e.$api.payExpress(this.form).then((function(t){e.$toast.showToast("提交成功"),setTimeout((function(){e.navigateBack()}),400)}));else{if(!this.form.payCheck)return void e.$toast.showError("请勾选同意支付协议！");e.$api.payExpress(this.form).then((function(e){t.payForExpress(e)}))}else e.$toast.showError("订单编号不能为空！")}else e.$toast.showError("收货地址不能为空！")},paySucEvent:function(){e.$toast.showToast("支付成功"),setTimeout((function(){e.navigateBack()}),400)},payForExpress:function(t){var n=this,r=this,s=!1;if(t.hasOwnProperty("data")&&t.data.hasOwnProperty("package")&&t.data.package.indexOf("test_")>=0&&(s=!0),s)e.$api.testPay({timeStamp:t.data.timeStamp,nonceStr:t.data.nonceStr,package:t.data.package,paySign:t.data.paySign}).then((function(t){t.success?n.paySucEvent():e.$toast.showError("测试支付失败！")}));else if(r.form.channelType<4){var a="wxpay";switch(r.form.channelType){case 2:a="wxpay";break;case 3:a="alipay";break}e.requestPayment({provider:a,orderInfo:t.orderInfo,success:function(e){console.log("success:"+JSON.stringify(e)),this.paySucEvent()},fail:function(t){console.log("fail:"+JSON.stringify(t)),e.$toast.showError(JSON.stringify(t))}})}}}};t.default=a}).call(this,n("543d")["default"])},"803c":function(e,t,n){},"8b87":function(e,t,n){"use strict";n.r(t);var r=n("92d9"),s=n("1a2f");for(var a in s)"default"!==a&&function(e){n.d(t,e,(function(){return s[e]}))}(a);n("5d8c");var d,o=n("f0c5"),i=Object(o["a"])(s["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],d);t["default"]=i.exports},"92d9":function(e,t,n){"use strict";var r;n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return r}));var s=function(){var e=this,t=e.$createElement;e._self._c},a=[]},9436:function(e,t,n){"use strict";(function(e){n("27ea");r(n("66fd"));var t=r(n("cba2"));function r(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},c0d8:function(e,t,n){"use strict";n.r(t);var r=n("7a98"),s=n.n(r);for(var a in r)"default"!==a&&function(e){n.d(t,e,(function(){return r[e]}))}(a);t["default"]=s.a},cba2:function(e,t,n){"use strict";n.r(t);var r=n("eb49"),s=n("c0d8");for(var a in s)"default"!==a&&function(e){n.d(t,e,(function(){return s[e]}))}(a);n("d475");var d,o=n("f0c5"),i=Object(o["a"])(s["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],d);t["default"]=i.exports},d475:function(e,t,n){"use strict";var r=n("803c"),s=n.n(r);s.a},eb49:function(e,t,n){"use strict";var r;n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return r}));var s=function(){var e=this,t=e.$createElement,n=(e._self._c,e.orderAddress&&e.order.orderOtherMoney>0?e.getExpressAreaName(e.orderAddress.addressAreaString):null),r=e.details&&e.details.length>0?e.getMoneyForYuan(e.order.orderMoney):null,s=e.details&&e.details.length>0?e.getMoneyForFen(e.order.orderMoney):null,a=e.getMoneyForYuan(e.order.orderPayMoney),d=e.getMoneyForFen(e.order.orderPayMoney);e._isMounted||(e.e0=function(t){t.stopPropagation(),e.form.payCheck=!e.form.payCheck},e.e1=function(t){e.showAddress=!1}),e.$mp.data=Object.assign({},{$root:{m0:n,m1:r,m2:s,m3:a,m4:d}})},a=[]}},[["9436","common/runtime","common/vendor"]]]);